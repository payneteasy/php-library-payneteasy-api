<?php

namespace PaynetEasy\PaynetEasyApi\Callback;

use PaynetEasy\PaynetEasyApi\Transport\CallbackResponse;
use PaynetEasy\PaynetEasyApi\PaymentData\PaymentTransaction;

/**
 * Generated by PHPUnit_SkeletonGenerator 1.2.1 on 2013-06-19 at 13:09:32.
 */
class RedirectUrlCallbackTest extends CallbackTestPrototype
{
    /**
     * @var RedirectUrlCallback
     */
    protected $object;

    /**
     * Sets up the fixture, for example, opens a network connection.
     * This method is called before a test is executed.
     */
    protected function setUp()
    {
        $this->object = new CustomerReturnCallback('_');
    }

    public function testProcessCallbackApprovedProvider()
    {
        return array(array(array
        (
            'status'            => 'approved',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
        )));
    }

    public function testProcessCallbackDeclinedProvider()
    {
        return array(
        array(array
        (
            'status'            => 'declined',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
        )),
        array(array
        (
            'status'            => 'filtered',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
        )));
    }

    public function testProcessCallbackErrorProvider()
    {
        return array(array(array
        (
            'status'            => 'error',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
            'error_message'     => 'test type error message',
            'error_code'        =>  5
        )));
    }

    /**
     * @expectedException \PaynetEasy\PaynetEasyApi\Exception\ValidationException
     * @expectedExceptionMessage Invalid callback status: 'processing'
     */
    public function testProcessCallbackWithInvalidStatus()
    {
        $paymentTransaction = $this->getPaymentTransaction();

        $callback = array
        (
            'status'            => 'processing',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
        );

        $callback['control'] = $this->createSignature($callback);

        $this->object->processCallback($paymentTransaction, new CallbackResponse($callback));
    }

    /**
     * @expectedException \PaynetEasy\PaynetEasyApi\Exception\ValidationException
     * @expectedExceptionMessage Only processing payment transaction can be processed
     */
    public function testProcessCallbackWithFinishedTransaction()
    {
        $paymentTransaction = $this->getPaymentTransaction();
        $paymentTransaction->setStatus(PaymentTransaction::STATUS_APPROVED);

        $callback = array
        (
            'status'            => 'processing',
            'amount'            =>  0.99,
            'orderid'           =>  self::PAYNET_ID,
            'merchant_order'    =>  self::CLIENT_ID,
            'client_orderid'    =>  self::CLIENT_ID,
        );

        $callback['control'] = $this->createSignature($callback);

        $this->object->processCallback($paymentTransaction, new CallbackResponse($callback));
    }
}
